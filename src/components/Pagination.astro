---
const { currentPage, totalPages, prevUrl, nextUrl } = Astro.props;

/**
 * Genera un array de números de página con puntos suspensivos para la paginación.
 */
const getPaginationWithEllipsis = (
  currentPage: number,
  totalPages: number,
  siblings: number = 1,
) => {
  const totalNumbersToShow = siblings * 2 + 5;

  if (totalPages <= totalNumbersToShow) {
    return Array.from({ length: totalPages }, (_, i) => i + 1);
  }

  const leftSiblingIndex = Math.max(currentPage - siblings, 1);
  const rightSiblingIndex = Math.min(currentPage + siblings, totalPages);
  const shouldShowLeftDots = leftSiblingIndex > 2;
  const shouldShowRightDots = rightSiblingIndex < totalPages - 2;
  const firstPageIndex = 1;
  const lastPageIndex = totalPages;

  if (!shouldShowLeftDots && shouldShowRightDots) {
    const leftItemCount = 3 + 2 * siblings;
    const leftRange = Array.from({ length: leftItemCount }, (_, i) => i + 1);
    return [...leftRange, "...", totalPages];
  }

  if (shouldShowLeftDots && !shouldShowRightDots) {
    const rightItemCount = 3 + 2 * siblings;
    const rightRange = Array.from(
      { length: rightItemCount },
      (_, i) => totalPages - rightItemCount + 1 + i,
    );
    return [firstPageIndex, "...", ...rightRange];
  }

  if (shouldShowLeftDots && shouldShowRightDots) {
    const middleRange = Array.from(
      { length: rightSiblingIndex - leftSiblingIndex + 1 },
      (_, i) => leftSiblingIndex + i,
    );
    return [firstPageIndex, "...", ...middleRange, "...", lastPageIndex];
  }

  return Array.from({ length: totalPages }, (_, i) => i + 1);
};

const pages = getPaginationWithEllipsis(currentPage, totalPages);
---

<nav class="flex items-center gap-6 justify-center mt-20">
  {
    prevUrl ? (
      <a
        href={prevUrl}
        class="text-xs uppercase font-bold tracking-widest text-secondary hover:text-primary dark:text-gray-400 dark:hover:text-white transition-colors"
      >
        Anterior
      </a>
    ) : (
      <span class="text-xs uppercase font-bold tracking-widest text-gray-300 dark:text-gray-600 cursor-not-allowed">
        Anterior
      </span>
    )
  }

  <div class="flex gap-2">
    {
      pages.map((page) =>
        typeof page === "number" ? (
          <a
            href={page === 1 ? "/blog" : `/blog/page/${page}`}
            class={`w-8 h-8 flex items-center justify-center text-xs font-bold transition-colors ${
              currentPage === page
                ? "border border-primary text-primary dark:border-white dark:text-white"
                : "text-gray-400 hover:text-primary dark:hover:text-white"
            }`}
            aria-current={currentPage === page ? "page" : undefined}
          >
            {page}
          </a>
        ) : (
          <span class="w-8 h-8 flex items-center justify-center text-xs text-gray-400">
            &hellip;
          </span>
        ),
      )
    }
  </div>

  {
    nextUrl ? (
      <a
        href={nextUrl}
        class="text-xs uppercase font-bold tracking-widest text-primary hover:text-black dark:text-white transition-colors"
      >
        Siguiente
      </a>
    ) : (
      <span class="text-xs uppercase font-bold tracking-widest text-gray-300 dark:text-gray-600 cursor-not-allowed">
        Siguiente
      </span>
    )
  }
</nav>
